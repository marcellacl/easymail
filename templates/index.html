<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>EasyMail</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>

    <div class="container">
        <h1>EasyMail</h1>

        <div class="upload-area">
            <label class="upload-label">
                <input type="file" id="fileInput" accept=".txt">
                Selecionar arquivo
            </label>
            <span id="fileName">Nenhum arquivo selecionado</span>
        </div>

        <textarea id="manualText" placeholder="Ou cole seu texto aqui..."></textarea>

        <button onclick="uploadFile()" class="analyze-btn">Analisar</button>

        <div id="result" style="display:none;">
            <h2>Resultado</h2>

            <p><strong>Classificação</strong></p>
            <div id="classificacao"></div>

            <p><strong>Resumo</strong></p>
            <div id="resumo"></div>

            <p><strong>Resposta sugerida</strong></p>
            <div id="resposta"></div>
        </div>

    </div>

<script>
document.getElementById("fileInput").addEventListener("change", function () {
    document.getElementById("fileName").innerText =
        this.files.length ? this.files[0].name : "Nenhum arquivo selecionado";
});

async function uploadFile() {
    const file = document.getElementById("fileInput").files[0];
    const manualText = document.getElementById("manualText").value.trim();

    if (!file && !manualText) {
        alert("Envie um arquivo ou texto.");
        return;
    }

    const formData = new FormData();

    if (file) {
        formData.append("file", file);
    } else {
        formData.append("file", new Blob([manualText], { type: "text/plain" }));
    }

    const response = await fetch("/api/upload", {
        method: "POST",
        body: formData
    });

    const data = await response.json();

    if (data.error) {
        alert("Erro: " + data.error);
        return;
    }

    document.getElementById("classificacao").innerText = data.classificacao || "-";
    document.getElementById("resumo").innerText = data.resumo || "-";
    document.getElementById("resposta").innerText = data.resposta_sugerida || "-";

    document.getElementById("result").style.display = "block";
}
</script>

</body>
</html>
